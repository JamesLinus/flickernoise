#!/bin/sh
. ./Common

###############################################################################

ptest "not: !a" << EOF
sx = !a
EOF
expect <<EOF
sx = (! a)
EOF

#------------------------------------------------------------------------------

ptest "not: !0" << EOF
sx = !0
EOF
expect <<EOF
sx = 1
EOF

#------------------------------------------------------------------------------

ptest "not: !1" << EOF
sx = !1
EOF
expect <<EOF
sx = 0
EOF

#------------------------------------------------------------------------------

ptest "not: !a*b" << EOF
sx = !a*b
EOF
expect <<EOF
sx = (* (! a) b)
EOF

#------------------------------------------------------------------------------

ptest "not: -!a" << EOF
sx = -!a
EOF
expect <<EOF
sx = (- (! a))
EOF

#------------------------------------------------------------------------------

ptest "not: !-b" << EOF
sx = !-b
EOF
expect <<EOF
sx = (! (- b))
EOF

#------------------------------------------------------------------------------

ptest "not: if (!a, b, c)" << EOF
sx = if (!a, b, c)
EOF
expect <<EOF
sx = (if a c b)
EOF

#------------------------------------------------------------------------------

ptest "not: !a ? b : c" << EOF
sx = !a ? b : c
EOF
expect <<EOF
sx = (if a c b)
EOF

#------------------------------------------------------------------------------

ptest "not: !0 ? b : c" << EOF
sx = !0 ? b : c
EOF
expect <<EOF
sx = b
EOF

#------------------------------------------------------------------------------

ptest "not: !1 ? b : c" << EOF
sx = !1 ? b : c
EOF
expect <<EOF
sx = c
EOF

#------------------------------------------------------------------------------

ptest "not: !sx (generate code)" -c << EOF
per_frame: wave_a = !sx
EOF
sedit '/^per-frame/,/^Eff/p;d'
expect <<EOF
per-frame PFPU fragment:
R003 = 1.000000 fWaveAlpha
R004 = 1.000000 sx
0000: EQUAL   R004,R005 <L=2 E=0002> 
0001: COPY    R000      <L=2 E=0003> 
0002: COPY    R001      <L=2 E=0004> -> R003
0003: NOP                            -> R002
0004: NOP                            -> R006
0005: VECTOUT R000,R000 <L=0 E=0005> 
Efficiency: 50%
EOF

###############################################################################
